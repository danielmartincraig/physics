<!DOCTYPE html>
<html>
<head>
    <% include ../partials/header.ejs %>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

    <script>
        function plotTrajectory(ctx, launchAngle, velocity) {
            let xVelocity = Math.cos(launchAngle * Math.PI / 180) * velocity;
            let yVelocity = Math.sin(launchAngle * Math.PI / 180) * velocity;

            let canvasHeight = ctx.canvas.height;

            let myProjectile = new projectile(xVelocity, yVelocity, 5);
            ctx.moveTo(0,0);
            while (myProjectile.y >= 0) {
                ctx.beginPath();
                ctx.rect(myProjectile.x, canvasHeight - myProjectile.y, myProjectile.squareSize, myProjectile.squareSize);
                ctx.stroke();
                myProjectile.advance();
            }
        }
    </script>

</head>
<body>
<% include ../partials/nav.ejs %>

<h1>Physics Simulation!</h1>

<div><canvas id="simCanvas" width=600 height=400>
    </canvas></div>

<script>

    class projectile {
        constructor (vx, vy, squareSize) {
            this.x = 0;
            this.y = squareSize;
            this.vx = vx;
            this.vy = vy;
            this.squareSize = squareSize
        }

        advance() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy -= 9.8;
        }
    }

</script>

<form>
    Launch Angle: <input type="text" id="launchAngle" placeholder="45">
    Velocity: <input type="text" id="velocity" placeholder="50">
    Initials: <input type="text" id="initials" placeholder="DMC">
    <button id="newTrajectoryButton">New Trajectory</button>
</form>

<script>
    let newTrajectoryButton = document.getElementById("newTrajectoryButton");
    newTrajectoryButton.addEventListener('click', function(e) {
        e.preventDefault();
        let launchAngle = document.getElementById("launchAngle").value;
        let velocity = document.getElementById("velocity").value;

        let request = new XMLHttpRequest();

        request.open("post", "https://agile-depths-52131.herokuapp.com/sim", true);
        request.setRequestHeader("Content-type", "application/json");
        let data = JSON.stringify({"launchAngle":launchAngle, "velocity": velocity});
        request.send(data);
    });
</script>

<form name="trajectoryHistory">
    <table>
        <% trajectories.forEach(function(entry) { %>
        <tr>
            <td><input type="checkbox" name="trajectoryCheckbox" data-shotAngle='<%= entry["shot_angle"]%>' data-velocity='<%= entry["shot_velocity"]%>'></td>
            <td><%= entry["shot_angle"] %></td>
            <td><%= entry["shot_velocity"] %></td>
        </tr>
        <% }) %>
    </table>
    <button id="simulateTrajectoriesButton">Simulate Trajectories</button>
</form>

<script>
    let simulateTrajectoriesButton = document.getElementById("simulateTrajectoriesButton");
    simulateTrajectoriesButton.addEventListener('click', function (e) {
        e.preventDefault();

        let myCanvas = document.getElementById("simCanvas");
        let ctx = myCanvas.getContext("2d");
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.stroke();

        let checkedBoxes = document.querySelectorAll('input[name=trajectoryCheckbox]:checked');
        console.log(checkedBoxes);
        checkedBoxes.forEach((trajectory) => {
            plotTrajectory(ctx, trajectory.getAttribute("data-shotAngle"), trajectory.getAttribute("data-velocity"));
            console.log(`Plotting the trajectory: ${trajectory.getAttribute("data-shotAngle")}, ${trajectory.getAttribute("data-velocity")}`);
        })

    })

</script>


</body>
</html>
